<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="PCBS">
<title>Differential Methylation with PCBS • PCBS</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Differential Methylation with PCBS">
<meta property="og:description" content="PCBS">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">PCBS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Differential_Methylation.html">Differential Methylation with PCBS</a>
    <a class="dropdown-item" href="../articles/Manipulating_Percent_Methylation.html">Manipulating Percent Methylation</a>
    <a class="dropdown-item" href="../articles/Optimizing_DMR_Calling.html">Optimizing DMR Calling</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/katlande/PCBS/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Differential Methylation with PCBS</h1>
                        <h4 data-toc-skip class="author">Kathryn
Lande</h4>
            
            <h4 data-toc-skip class="date">2024-02-29</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/katlande/PCBS/blob/HEAD/vignettes/Differential_Methylation.Rmd" class="external-link"><code>vignettes/Differential_Methylation.Rmd</code></a></small>
      <div class="d-none name"><code>Differential_Methylation.Rmd</code></div>
    </div>

    
    
<p>Eigenvector WGBS analysis is built on the simple premise that in a
principal components analysis of all CpGs in a whole genome bisulfite
seq (WGBS) experiment, the eigenvector values of each CpG in the
principal component that best defines the treatment can be used as a
quantitative score for comparative analysis. Simply put: if a principal
component strongly delineates two conditions, then the contribution of a
single CpG to that principal component will be larger if that CpG is
highly different between conditions.</p>
<p>Eigenvector values are continuous, and allow for more flexible
analyses than those predicated on a p-value cut-off system. In
comparison to other common WGBS tools, Eigenvector analysis is generally
faster. It shows comparable ability to call differentially methylated
loci (DMLs) to current standard tools, and in test genomes it shows 
remarkably accurate differentially methylated region (DMR) calling both 
in terms of the number of DMRs called, as well as the size of DMRs
called.</p>
<p>Currently, Eigenvector WGBS analysis is only set up to handle
comparisons of two-condition, one-factor experiments.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/katlande/PCBS" class="external-link">PCBS</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="reading-in-our-input-file">Reading in our input file<a class="anchor" aria-label="anchor" href="#reading-in-our-input-file"></a>
</h2>
<p>We provide a script, Bismark2Matrix.R, that can be used to covert
Bismark outputed .cov files into the below format.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eigen</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">##          cpgID trt1_PercMeth trt1_nCpG trt2_PercMeth trt2_nCpG</span></span>
<span><span class="co">## 1 chr2:2505718     0.5581395        43     0.4084507        71</span></span>
<span><span class="co">## 2 chr2:1807326     0.5652174        69     0.4883721        43</span></span>
<span><span class="co">## 3 chr2:2490208     0.4489796        49     0.5416667        72</span></span>
<span><span class="co">## 4 chr2:5512828     0.5263158        38     0.6315789        19</span></span>
<span><span class="co">## 5 chr3:1296629     0.6000000        35     0.4242424        66</span></span></code></pre></div>
<div class="section level5">
<h5 id="section"></h5>
</div>
</div>
<div class="section level2">
<h2 id="defining-our-best-principal-component">Defining our best principal component<a class="anchor" aria-label="anchor" href="#defining-our-best-principal-component"></a>
</h2>
<p>Here we identify which principal component (PC) best defines the
difference between treatment and control. If multiple PCs delineate the
conditions, the PC contributing the most variance will be chosen.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/DefineBestPC.html">DefineBestPC</a></span><span class="op">(</span><span class="va">eigen</span>, IDs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"trt"</span>, <span class="st">"ctl"</span><span class="op">)</span><span class="op">)</span> <span class="co"># IDs segregate two conditions based on a common identifier in the column names of the eigen dataframe, rather than by column number. You may have to rename the columns of your input object if no common name exists.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Best PC to use is PC1 with a sample distance of 45.4, representing 29.81% of the total variance.</span></span></code></pre></div>
<p><img src="Differential_Methylation_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="score-each-cpg-by-its-eigenvector-value">Score each CpG by its eigenvector value<a class="anchor" aria-label="anchor" href="#score-each-cpg-by-its-eigenvector-value"></a>
</h2>
<p>As PC1 was defined as our best PC, we should set PC=1 The first
condition in the IDs=c() option will always be treated as the treatment.
Positive eigenvector scores (PC_Score) mean that there is increased
methylation in the treatment condition (hypermethylation), whereas
negative eigenvector scores indicate decreased methylation in the
treatment condition (hypomethylation).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/getPCRanks.html">getPCRanks</a></span><span class="op">(</span><span class="va">eigen</span>, IDs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"trt"</span>, <span class="st">"ctl"</span><span class="op">)</span>, PC <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">ranks</span> <span class="co"># Get an eigenvector score for each CpG based on principal component 1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ranks</span><span class="op">)</span></span>
<span><span class="co">##                   PC_Score</span></span>
<span><span class="co">## chr2:2505718  3.781088e-05</span></span>
<span><span class="co">## chr2:1807326  4.573342e-04</span></span>
<span><span class="co">## chr2:2490208  3.156102e-03</span></span>
<span><span class="co">## chr2:5512828 -5.695585e-03</span></span>
<span><span class="co">## chr3:1296629  2.822282e-03</span></span>
<span><span class="co">## chr3:3212276 -6.044066e-03</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="identifying-a-dml-cut-off">Identifying a DML cut-off<a class="anchor" aria-label="anchor" href="#identifying-a-dml-cut-off"></a>
</h2>
<p>Eigenvector analysis does not assign p-values to individual CpGs.
However, in test datasets, score-based cut-offs show comparable ability
to define true DMLs as other tools that do assign p-values. We offer
functionality to define a cut-off score for differential
vs. non-differential DMLs, though note that this type of analysis is not
the primary function of eigenvector analysis.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rankDist.html">rankDist</a></span><span class="op">(</span><span class="va">ranks</span>, mode<span class="op">=</span><span class="st">"intersect"</span><span class="op">)</span> <span class="co"># Two modes "intersect" and "strict"</span></span>
<span><span class="co">## Estimated rank cut-off for significant CpGs is 980.</span></span></code></pre></div>
<p><img src="Differential_Methylation_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>Generally speaking, the best cut-off rank occurs just above the
inflection point of the plot of Absolute Rank vs. Absolute Score. The
cut-off can be estimated manually from the plot, or the rankDist()
function can be used to estimate the cutoff as above. rankDist() offers
two modes. The “intersect” method defines the cut-off as the
intersection between the linear line of best fit for the highest scoring
CpGs (true variation), and the that of the lowest scoring CpGs
(background noise). Alternatively, the “strict” method defines the
cut-off simply as half the distance between the maximum rank used to
define the line of best fit for the highest scoring CpGs and the value
produced by intersect mode.</p>
<p>In high variability test genomes, PC-strict and PC-intersect perform
comparably to each other and other softwares. In low-variability test
genomes, PC-strict greatly out preforms PC-intersct as well most other
tested softwares in false positive reduction, though this comes at the
cost of a slight increase in false negative calls. Generally, PC-Strict
is better in comparisons where the expected number of true DMLs is
relatively low.</p>
<p>Please note that these are simply estimations. If the predicted
cut-off returned is much higher or much lower than the inflection point
as demonstrated in the figure above, it is recommended to select a
cut-off rank manually.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DMLs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/addRanks.html">addRanks</a></span><span class="op">(</span><span class="va">ranks</span><span class="op">)</span> <span class="co"># add rank order to our CpGs</span></span>
<span><span class="va">DMLs</span><span class="op">$</span><span class="va">significant</span> <span class="op">&lt;-</span> <span class="va">DMLs</span><span class="op">$</span><span class="va">abs.order</span> <span class="op">&lt;=</span> <span class="fl">980</span> <span class="co"># significant CpG cut-off defined by rankDist() is: 980</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">DMLs</span><span class="op">)</span></span>
<span><span class="co">##                 PC_Score order abs.order  chr     pos significant</span></span>
<span><span class="co">## chr3:3291453  0.03364091     1         1 chr3 3291453        TRUE</span></span>
<span><span class="co">## chr3:31670    0.03343012     2         2 chr3   31670        TRUE</span></span>
<span><span class="co">## chr3:3082482  0.03337153     3         3 chr3 3082482        TRUE</span></span>
<span><span class="co">## chr2:350483  -0.03296202 50000         4 chr2  350483        TRUE</span></span>
<span><span class="co">## chr1:8652017  0.03291018     4         5 chr1 8652017        TRUE</span></span>
<span><span class="co">## chr3:4531184 -0.03270712 49999         6 chr3 4531184        TRUE</span></span></code></pre></div>
<p>We now have a file with a boolean "significance" for all CpGs.
For users who wish to look at differential loci exclusively, we
recommend using a package that calculates true p-values at the 
locus level, such as <a href="https://bioconductor.org/packages/release/bioc/html/DSS.html" class="external-link">DSS</a>.</p>
</div>
<div class="section level2">
<h2 id="identifying-a-dml-cut-off-manually">Identifying a DML cut-off manually<a class="anchor" aria-label="anchor" href="#identifying-a-dml-cut-off-manually"></a>
</h2>
<p>In some cases, the cut-off predicted by getPCRanks may look
imperfect. In such cases, cut-off values can be tested manually:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test_50</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/checkRank.html">checkRank</a></span><span class="op">(</span><span class="va">ranks</span>, <span class="fl">50</span><span class="op">)</span> <span class="co"># set cut-off to 50</span></span>
<span><span class="va">test_500</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/checkRank.html">checkRank</a></span><span class="op">(</span><span class="va">ranks</span>, <span class="fl">500</span><span class="op">)</span> <span class="co"># set cut-off to 500</span></span>
<span><span class="va">test_5000</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/checkRank.html">checkRank</a></span><span class="op">(</span><span class="va">ranks</span>, <span class="fl">5000</span><span class="op">)</span> <span class="co"># set cut-off to 5000</span></span>
<span><span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="va">test_50</span><span class="op">+</span><span class="fu">tilt</span><span class="op">(</span><span class="op">)</span>, <span class="va">test_500</span><span class="op">+</span><span class="fu">tilt</span><span class="op">(</span><span class="op">)</span>, <span class="va">test_5000</span><span class="op">+</span><span class="fu">tilt</span><span class="op">(</span><span class="op">)</span>, nrow<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="Differential_Methylation_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="calling-dmrs">Calling DMRs<a class="anchor" aria-label="anchor" href="#calling-dmrs"></a>
</h2>
<p>Differentially methylated region (DMR) calling is where eigenvector
analysis shines. In simulated genomes, the eigenvector-based DMR calling
system has an extremely low false call rate compared to other tested softwares
(false positive + false negative). Basepair for basepair, most other DMR
callers dramatically over predict the size of DMR regions compared to
the present method.</p>
<p>Our DMR calling algorithm works by defining a rank cut-off, wherein
CpGs below this rank are extracted as seeds. Nearby CpGs are collapsed
into single seed points at their median. The function expands outwards
from each seed point up to a maximum DMR size, then identifies the
smallest expansion containing over 90% of the most variable CpGs.</p>
<p>In general, the only downside to using a larger number of seeds is
that the DMR calling will take more time. However, with smaller or more
sparse genomes, you can run into a problem called “overcompression.”
This occurs when seeds from multiple DMRs are collapsed into single
points, causing the total number of DMRs to be underestimated. The
function below can be used to check for overcompression.</p>
<p>Broadly, as long as you are not overcompressing, increasing the
number of seeds will increase your true postive calls without increasing
your false positive calls. A smaller seed number will find fewer
significant DMRs, while a larger seed number will be able to identify a
greater number of DMRs at the cost of computing time. In general, the 
number of significant DMR calls plateaus at a seed number ~1-3% of the 
total filtered CpGs. To read more about DMR seeds and overcompression, see our
vignette on <a href="https://katlande.github.io/PCBS/articles/Optimizing_DMR_Calling.html" class="external-link">Optimizing
DMR Calling</a>.</p>
<div class="section level5">
<h5 id="dmr-calling-occurs-in-two-steps">DMR calling occurs in two steps:<a class="anchor" aria-label="anchor" href="#dmr-calling-occurs-in-two-steps"></a>
</h5>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/CheckOvercompression.html">CheckOvercompression</a></span><span class="op">(</span><span class="va">ranks</span>, <span class="fl">980</span><span class="op">)</span> <span class="co"># For larger genomes, the target seed number will usually be about 1-2% of the number of rows in the ranks file. But in this small test set, we are just testing values around the DML cut-off.</span></span>
<span><span class="co">## ............. done!</span></span></code></pre></div>
<p><img src="Differential_Methylation_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<! <code class="sourceCode R"><span><span class="va">chromDictObj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/chromDict.html">chromDict</a></span><span class="op">(</span><span class="va">ranks</span>)</span> <span class="co"># Optional step to create a chromDict object, this step is computationally intensive and run internally in many functions, so it is recommended to generate it one time only.</span></span> ––>
<code class="sourceCode R"><span><span class="va">DMRs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Get_Novel_DMRs.html">Get_Novel_DMRs</a></span><span class="op">(</span><span class="va">ranks</span>, <span class="fl">2940</span>, chromDictObj<span class="op">=</span><span class="va">chromDictObj</span>, DMR_resolution<span class="op">=</span><span class="fl">200</span>, minCpGs<span class="op">=</span><span class="fl">10</span><span class="op">)</span> <span class="co"># No overcompression was detected, so we will just use the largest seed value.</span></span>
<span><span class="co">##  done!</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">DMRs</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">DMRs</span><span class="op">$</span><span class="va">FDR</span>, decreasing <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="co">##      Chr   Start     End DMR_Zscore nCpGs            p DMR_size          FDR</span></span>
<span><span class="co">## 114 chr3 4920450 4923267  -39.63556    24 8.285957e-08     2817 2.982945e-06</span></span>
<span><span class="co">## 97  chr3 4140014 4142951  -25.08817    25 1.142786e-07     2937 3.999750e-06</span></span>
<span><span class="co">## 93  chr3 1340221 1342791  -26.34567    23 1.299903e-07     2570 4.419671e-06</span></span>
<span><span class="co">## 57  chr1 8650728 8652017   63.96288    13 2.851795e-06     1289 9.410925e-05</span></span>
<span><span class="co">## 125 chr3 3960576 3962805   14.61286    14 6.122748e-06     2229 1.959279e-04</span></span>
<span><span class="co">## 78  chr3 5080015 5081519  -33.10397    10 1.848491e-05     1504 5.730322e-04</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="score-pre-defined-regions">Score pre-defined regions<a class="anchor" aria-label="anchor" href="#score-pre-defined-regions"></a>
</h2>
<p>Eigenvector scores allow users to directly quantify methylation
differences across pre-defined regions such as TSSs, enhancers, or other
regions of interest. We offer functionality to assess these regions
directly, rather than by querying novel DMR calls for overlaps.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make a dataframe of regions to check:</span></span>
<span><span class="va">regions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>chr<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"chr3"</span>, <span class="st">"chr3"</span>, <span class="st">"chr1"</span><span class="op">)</span>,</span>
<span>                      s<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4920450</span>, <span class="fl">3961576</span>, <span class="fl">301000</span><span class="op">)</span>,</span>
<span>                      e<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4923267</span>, <span class="fl">3963805</span>, <span class="fl">303900</span><span class="op">)</span>,</span>
<span>                      ID<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Hypo-DMR"</span>, <span class="st">"partial Hyper-DMR"</span>, <span class="st">"random"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/getRegionScores.html">getRegionScores</a><span class="op">(chromDictObj<span class="op">=</span><span class="va">chromDictObj</span>, regions<span class="op">=</span><span class="va">regions</span>)</span></span>
<span><span class="co">##             feature       meanPC nCpG          Z            p</span></span>
<span><span class="co">## 1          Hypo-DMR -0.020963435   24 -5.2595086 9.074176e-08</span></span>
<span><span class="co">## 2 partial Hyper-DMR  0.008092709    8  2.1387060 2.550247e-06</span></span>
<span><span class="co">## 3            random -0.001061349    4 -0.3405263 3.103850e-01</span></span></code></pre></div>
<p>getRegionScores returns the mean eigenvector scores for each input
region, as well as Z-score against the background, and a p-value. As you
can see in our test set, true DMRs and regions partially overlapping
true DMRs are significant, whereas random regions do not show
enrichment. Of note, the Z-scores calculated by this function and those
calculated by Get_Novel_DMRs() are not directly comparable, as getRegionScores()
only samples the genomic background, but does not bootstrap it. In both the case
of novel DMRs and known regions, Z-scores strongly correlate to the true
mean percent methylation at a region, where larger Z-scores indicate a greater
difference between treatment and control, and the sign of the Z-score indicates
whether the difference is larger or smaller in the treatment. However, PCBS also
offers functionality that allows users to investigate the percent methylation difference
across regions. See our vignette on <a href="https://katlande.github.io/PCBS/articles/Manipulating_Percent_Methylation.html" class="external-link">Manipulating Percent Methylation</a>.</p> </p>
</div>
<div class="section level2">
<h2 id="metagenes">Metagenes<a class="anchor" aria-label="anchor" href="#metagenes"></a>
</h2>
<p>We also provide functionality for generating metagenes over a set of
regions based on PC Scores. In these figures, values above 0 represent
regions where the treatment group is hypermethylated, while values below
0 represent hypomethylated regions.</p>
<div class="section level5">
<h5 id="make-a-metagene-from-the-significant-hypermethylated-dmrs">Make a metagene from the significant hypermethylated DMRs:<a class="anchor" aria-label="anchor" href="#make-a-metagene-from-the-significant-hypermethylated-dmrs"></a>
</h5>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hyper_DMRs</span> <span class="op">&lt;-</span> <span class="va">DMRs</span><span class="op">[</span><span class="va">DMRs</span><span class="op">$</span><span class="va">FDR</span> <span class="op">&lt;=</span> <span class="fl">0.05</span> <span class="op">&amp;</span> <span class="va">DMRs</span><span class="op">$</span><span class="va">DMR_Zscore</span> <span class="op">&gt;</span> <span class="fl">0</span>,<span class="op">]</span> <span class="co"># Select all significantly hypermethylated DMRs</span></span>
<span><span class="va">regions_hyper</span> <span class="op">&lt;-</span> <span class="va">hyper_DMRs</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">]</span> <span class="co"># select chrom, start, and end of all hyper DMRs</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/PCBS/man/score_metagene.html" class="external-link">score_metagene</a></span><span class="op">(</span><span class="va">ranks</span>, chromDictObj<span class="op">=</span><span class="va">chromDictObj</span>, <span class="va">regions_hyper</span><span class="op">)</span></span></code></pre></div>
<p><img src="Differential_Methylation_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>Our hypermethylated DMR regions broadly show a highly positive
PC-score across the regions. This is what we expect for hypermethylated
regions.</p>
</div>
<div class="section level5">
<h5 id="plot-metagenes-of-multiple-regions-together">Plot metagenes of multiple regions together<a class="anchor" aria-label="anchor" href="#plot-metagenes-of-multiple-regions-together"></a>
</h5>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Let's plot the metagene of the hyper-DMRs and hypo-DMRs together on the same plot..</span></span>
<span></span>
<span><span class="va">hypo_DMRs</span> <span class="op">&lt;-</span> <span class="va">DMRs</span><span class="op">[</span><span class="va">DMRs</span><span class="op">$</span><span class="va">FDR</span> <span class="op">&lt;=</span> <span class="fl">0.05</span> <span class="op">&amp;</span> <span class="va">DMRs</span><span class="op">$</span><span class="va">DMR_Zscore</span> <span class="op">&lt;</span> <span class="fl">0</span>,<span class="op">]</span> <span class="co"># Select all significantly hypermethylated DMRs</span></span>
<span><span class="va">regions_hypo</span> <span class="op">&lt;-</span> <span class="va">hypo_DMRs</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">]</span> <span class="co"># select chrom, start, and end of all hyper DMRs</span></span>
<span></span>
<span><span class="co"># Setting return.data = T will cause score_metagene to return raw data instead of a plot</span></span>
<span><span class="va">hyper_metagene</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/PCBS/man/score_metagene.html" class="external-link">score_metagene</a></span><span class="op">(</span><span class="va">ranks</span>, <span class="va">regions_hyper</span>, chromDictObj<span class="op">=</span><span class="va">chromDictObj</span>, return.data <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">hypo_metagene</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/PCBS/man/score_metagene.html" class="external-link">score_metagene</a></span><span class="op">(</span><span class="va">ranks</span>, <span class="va">regions_hypo</span>, chromDictObj<span class="op">=</span><span class="va">chromDictObj</span>, return.data <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The multiple_metagenes function plots multiple metagenes using a list of raw data objects from score_metagene().</span></span>
<span><span class="fu"><a href="../reference/multiple_metagenes.html">multiple_metagenes</a></span><span class="op">(</span>data_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">hyper_metagene</span>, <span class="va">hypo_metagene</span><span class="op">)</span>, <span class="co"># list of raw data</span></span>
<span>                   set_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Hyper DMRs"</span>, <span class="st">"Hypo DMRs"</span><span class="op">)</span>, <span class="co"># names for elements of the data_list list</span></span>
<span>                   title<span class="op">=</span><span class="st">"Metagenes of DMR Regions"</span>, legend.title <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<p><img src="Differential_Methylation_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>As expected, our hypo-DMRs show very negative PC-score across the
regions. To learn how to make metagenes using percent methylation difference instead
of PC score, see our article on <a href="https://katlande.github.io/PCBS/articles/Manipulating_Percent_Methylation.html" class="external-link">Manipulating Percent Methylation</a>.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Kathryn Lande.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
