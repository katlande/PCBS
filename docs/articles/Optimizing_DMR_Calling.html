<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="PCBS">
<title>Optimizing DMR Calling • PCBS</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Optimizing DMR Calling">
<meta property="og:description" content="PCBS">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">PCBS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Differential_Methylation.html">Differential Methylation with PCBS</a>
    <a class="dropdown-item" href="../articles/Optimizing_DMR_Calling.html">Optimizing DMR Calling</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/katlande/PCBS/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Optimizing DMR Calling</h1>
                        <h4 data-toc-skip class="author">Kathryn
Lande</h4>
            
            <h4 data-toc-skip class="date">2024-04-11</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/katlande/PCBS/blob/HEAD/vignettes/Optimizing_DMR_Calling.Rmd" class="external-link"><code>vignettes/Optimizing_DMR_Calling.Rmd</code></a></small>
      <div class="d-none name"><code>Optimizing_DMR_Calling.Rmd</code></div>
    </div>

    
    
<p>PCBS’s DMR calling works by selecting a number of high-scoring CpGs,
and searching regions around these CpGs iteratively to identify if the
average CpG score near these seeds is significantly different from the
local background CpGs scores.</p>
<p>Because we expect many of the CpGs in a true DMR region to be
selected as seeds, seeds that are near each other are compressed into
single seed points before expansion in order to save computing time.</p>
<p>While simulations demonstrate that this algorithm is highly resistant
to false positives regardless of input seed number, if too few seeds are
included, DMRs around more weakly significant CpGs will be missed.
Conversely, if too many seeds are included, seeds can become
“overcompressed.” Overcompression occurs when seeds from multiple nearby
DMRs are compressed into a single seed, causing the algorithm to
identify a single DMR where multiple are found. Thus, for any dataset,
there is an optimal seed number that strikes a balance between including
too few seeds and overcompressing your data.</p>
<p>There are two ways to identify this value. The first is using the
CheckOvercompression() function. This function takes a vector of seed
values, and finds the number of compressed seeds for each value. If the
function identifies an input seed value wherein the number of compressed
seeds begins to decrease, this is a good sign that overcompression is
occurring.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/katlande/PCBS" class="external-link">PCBS</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">eigen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.delim</a></span><span class="op">(</span><span class="st">"WGBS.txt"</span><span class="op">)</span> <span class="co"># https://github.com/katlande/PCBS/WGBS.txt</span></span>
<span><span class="va">ranks</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getPCRanks.html">getPCRanks</a></span><span class="op">(</span><span class="va">eigen</span>, IDs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"trt"</span>, <span class="st">"ctl"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/CheckOvercompression.html">CheckOvercompression</a></span><span class="op">(</span><span class="va">ranks</span>, <span class="fl">1000</span><span class="op">)</span> <span class="co"># no overcompression</span></span>
<span><span class="co">## Checking 13 seed values for best DMR calling............. done!</span></span></code></pre></div>
<p><img src="Optimizing_DMR_Calling_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/CheckOvercompression.html">CheckOvercompression</a></span><span class="op">(</span><span class="va">ranks</span>, <span class="fl">15000</span><span class="op">)</span> <span class="co"># overcompression at 33,750 seeds</span></span>
<span><span class="co">## Checking 13 seed values for best DMR calling............. done!</span></span></code></pre></div>
<p><img src="Optimizing_DMR_Calling_files/figure-html/unnamed-chunk-2-2.png" width="700"></p>
<p>While this function is relatively fast, it should be used as a
safeguard rather than a seed number optimizing tool. In many cases,
overcompression can occur exclusively at the true DMR regions without
occurring globally in the dataset. This may happen if many of the
significant DMRs in your dataset are close together.</p>
<p>However, because this algorithm is so resistant to false negatives,
we can simply try DMR calling with a number of different input seeds,
and select the input value that returns the most significant DMRs:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">chrDict</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/chromDict.html">chromDict</a></span><span class="op">(</span><span class="va">ranks</span><span class="op">)</span> <span class="co"># speeds up the Get_Novel_DMRs() if we are running in loops</span></span>
<span></span>
<span><span class="co"># Run DMR calling in a loop and identify the number of significant DMRs for a set of </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">sig</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">seed</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">500</span>, <span class="fl">1000</span>, <span class="fl">2000</span>, <span class="fl">3000</span>, <span class="fl">5000</span>, <span class="fl">10000</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">DMR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Get_Novel_DMRs.html">Get_Novel_DMRs</a></span><span class="op">(</span><span class="va">ranks</span>, <span class="va">seed</span>, chromDictObj <span class="op">=</span> <span class="va">chrDict</span>, DMR_resolution<span class="op">=</span><span class="fl">200</span>, minCpGs<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sig</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">DMR</span><span class="op">[</span><span class="va">DMR</span><span class="op">$</span><span class="va">FDR</span> <span class="op">&lt;=</span> <span class="fl">0.05</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">sig</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>nSeeds<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">500</span>, <span class="fl">1000</span>, <span class="fl">2000</span>, <span class="fl">3000</span>, <span class="fl">5000</span>, <span class="fl">10000</span><span class="op">)</span>,</span>
<span>           nDMRs<span class="op">=</span><span class="va">sig</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">nSeeds</span>, y<span class="op">=</span><span class="va">nDMRs</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span> <span class="fu">Ol_Reliable</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Optimizing_DMR_Calling_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>In our test data, the optimal input would be around 2,000 seeds, much
lower than the global overcompression value of 33,750 seeds. We can see
a similar result the below data from<a href="https://pubmed.ncbi.nlm.nih.gov/28351383/">Cole et al 2017</a>’s mouse wildtype
data:</p>
<p><img src="Optimizing_DMR_Calling_files/cole_et_al_stats.png" width="700"></p>
<p>Here, CheckOvercompression() finds global overcompression occurring
around 5 million seeds (A), while total DMR calls actually peak at
around 100,000 seeds (B). Moreover, increasing seed number appears to
increase processing time exponentially (C) while increasing the DMR
calls logarithmically. Thus, in the case of Cole et al’s dataset,
100,000 seeds would be the optimal number.</p>
<p>In mouse WGBS datasets, we find that a seed number between 1-2% of
all input CpGs is generally a good number to approximate the optimal
input seed value while optimizing computational resource use. Here we
compare two wildtype mouse WGBS experiments, one from 2017 with only
around 8 millions CpGs after filtering, and one from 2022 with around 20
million CpGs after filtering. Though more testing is required to state
confidently, we suspect this to be a good expected optimal seed value
range for most datasets.</p>
<p><img src="Optimizing_DMR_Calling_files/Seed_Input_vs_Output.png" width="700"></p>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Kathryn Lande.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
